<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Chi : Cinematic Roleplay</title>
<style>
  :root{
    --bg:#000000;
    --panel:#121421;
    --accent:#ff6b3b;
    --accent-2:#ffb03a;
    --text:#e8e8f2;
    --muted:#94a3b8;
    --card-common:#2b2f44;
    --shadow:0 10px 30px rgba(0,0,0,.45);
    --player-height:62px;
    --opp-glow: rgba(255,56,56,0.9);
  }

  *{box-sizing:border-box}
  html,body{height:100%; overflow-x:hidden}
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font:500 16px/1.4 "Rajdhani", system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif;
    letter-spacing:.2px;
    display:flex; align-items:flex-start; justify-content:center;
    padding:0px 16px calc(var(--player-height) + 48px);
  }

  /* full bleed animated GIF background */
  .page-bg{
    position:fixed;
    inset:0;
    z-index:0;
    pointer-events:none;
    background:
      url('https://i.ibb.co/qMm7TKMz/The-Deadly-War-Between-Bloodhound-And-Risky-Road.gif') center/cover no-repeat fixed,
      url('https://i.imgur.com/z17MUhQ.png') center/cover no-repeat fixed;
    filter: blur(12px) saturate(1.08);
    opacity:.65;
    transform: scale(1.02);
  }

  .wrap{max-width:1280px; width:100%; margin:0 auto; position:relative; z-index:2}
  .topbar {
    position: sticky; top: 0; z-index: 100;
    background: linear-gradient(180deg, rgba(6,6,6,0.98), rgba(10,10,12,0.85));
    border-bottom: 1px solid rgba(255,255,255,0.04);
    backdrop-filter: blur(6px);
  }
  .hero { width:100%; margin-top:14px; }
  .hero-inner { padding:28px 20px; position:relative; z-index:2; }
  .hero-logo { position:absolute; top:12px; right:20px; height:88px; border-radius:6px; filter: drop-shadow(0 6px 18px rgba(0,0,0,.6)); }
  .hero-title { margin:0 0 6px 0; font-weight:900; letter-spacing:0.02em; font-size: clamp(28px, 4.4vw, 40px); color: var(--accent-2); }
  .hero-sub { margin:0; color:#cfe6ff; font-size:14px; }

  .nav { display:flex; gap:16px; margin-top:14px; z-index:2; }
  .nav-link { color:var(--text); text-decoration:none; font-size:14px; padding:6px 10px; border-radius:8px; transition:all .15s ease; }
  .nav-link:hover { color:var(--accent-2); transform: translateY(-2px); }
  .nav-link.active { background: rgba(255,255,255,0.02); }

  .nav-section { display:none; margin-top:18px; z-index:2; }
  .nav-section.active { display:block; }

  .section-card { background: linear-gradient(180deg, rgba(18,18,22,0.95), rgba(12,12,16,0.95)); border-radius:12px; padding:22px; box-shadow:var(--shadow); border:1px solid rgba(255,255,255,0.03); }
  .section-title { font-weight:800; font-size:20px; color:var(--accent); margin-bottom:12px; }

  .rr-list { margin:0; padding:0; list-style:none; color:#eaf5ff; }
  .rr-list-item { margin-bottom:10px; }
  .rr-list-title { font-weight:700; color:var(--accent-2); margin-right:8px; }

  /* watermark bottom center */
  .watermark{ position:fixed; left:50%; bottom:14px; transform:translateX(-50%); z-index:50; pointer-events:auto; font-weight:800; color:var(--accent-2); }
  .watermark a { color:inherit; text-decoration:none; padding:6px 10px; border-radius:8px; background:rgba(255,255,255,0.02); }

  /* bottom-left music player */
  .player {
    position:fixed; left:18px; bottom:12px; height:var(--player-height); min-width:340px; max-width:calc(100% - 36px);
    display:flex; gap:12px; align-items:center; padding:8px 12px; border-radius:12px;
    background: linear-gradient(180deg, rgba(18,18,22,0.98), rgba(12,12,16,0.96));
    box-shadow: 0 10px 30px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.03); z-index:10000;
  }
  .play-btn { width:46px; height:46px; border-radius:10px; display:grid; place-items:center; background: linear-gradient(90deg,var(--accent-2),var(--accent)); color:#08101a; border:none; cursor:pointer; font-weight:800; }
  .play-btn.paused { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--accent-2); }

  .track-meta { display:flex; flex-direction:column; min-width:0; overflow:hidden; gap:2px; }
  .track-title { font-weight:700; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .track-sub { font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

  .center { flex:1; display:flex; flex-direction:column; gap:6px; }
  .progress { height:6px; background:rgba(255,255,255,0.04); border-radius:6px; position:relative; cursor:pointer; overflow:hidden; }
  .progress .filled { position:absolute; left:0; top:0; bottom:0; width:0%; background: linear-gradient(90deg,var(--accent-2),var(--accent)); border-radius:6px; transition:width .12s linear; }
  .time-row { display:flex; justify-content:space-between; font-size:12px; color:var(--muted); }

  .right { display:flex; align-items:center; gap:8px; margin-left:8px; }
  .vol input[type=range] { width:96px; accent-color:var(--accent-2); }

  .small-btn { background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); color:var(--text); padding:8px; border-radius:10px; cursor:pointer; }

  /* unmute/play fallback */
  .unmute { position:fixed; right:18px; bottom:18px; z-index:10001; display:none; background: linear-gradient(90deg,var(--accent-2),var(--accent)); color:#08101a; padding:10px 14px; border-radius:12px; border:none; font-weight:800; cursor:pointer; }
  .unmute.show { display:flex; align-items:center; gap:8px; }

  /* discord vertical tab on right */
  .discord-tab {
    position:fixed; right:0; top:50%; transform:translateY(-50%); z-index:10002; display:flex; align-items:center; gap:6px;
    background: linear-gradient(180deg, rgba(18,18,22,0.98), rgba(12,12,16,0.96)); padding:8px 10px; border-top-left-radius:12px; border-bottom-left-radius:12px; border-left:1px solid rgba(255,255,255,0.02);
    box-shadow:-6px 8px 24px rgba(0,0,0,0.5);
  }
  .discord-tab a { color:var(--text); text-decoration:none; display:flex; align-items:center; gap:8px; padding: 6px; }

  /* Active members grid and modal */
  #membersGrid, #oppsGrid { display:grid; gap:12px; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); margin-top:10px; z-index:2; }
  .member-card, .opponent-card {
    background: linear-gradient(180deg, rgba(18,18,22,0.9), rgba(14,14,18,0.9));
    padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.03);
    cursor:pointer; display:flex; gap:10px; align-items:center; position:relative; overflow:visible;
  }
  .member-avatar, .opponent-avatar { width:56px; height:56px; border-radius:8px; object-fit:cover; border:1px solid rgba(255,255,255,0.04); }

  .member-name, .opponent-name { font-weight:800; color:var(--accent-2); font-size:14px; }
  .member-role, .opponent-role { color:var(--muted); font-size:13px; }

  /* Fortnite-like red glow outside the opponent boxes */
  .opponent-card::after {
    content: "";
    position: absolute;
    inset: -6px;
    border-radius: 14px;
    z-index: -1;
    background: radial-gradient(ellipse at center, rgba(255,80,80,0.35) 0%, rgba(255,40,40,0.08) 30%, transparent 60%);
    filter: blur(10px);
    opacity: 0.0;
    transition: opacity .18s ease, transform .18s ease;
  }
  .opponent-card:hover::after,
  .opponent-card.glow {
    opacity: 1;
    transform: scale(1.02);
    animation: pulseGlow 1.6s infinite;
  }
  @keyframes pulseGlow {
    0% { opacity:0.85; transform: scale(1.00); }
    50% { opacity:0.5; transform: scale(1.04); }
    100% { opacity:0.85; transform: scale(1.00); }
  }

  .modal-backdrop { position:fixed; inset:0; display:none; place-items:center; background: rgba(0,0,0,0.6); z-index:10003; }
  .modal-backdrop.show { display:grid; }
  .modal { width:min(720px,calc(100% - 40px)); background: linear-gradient(180deg, rgba(18,18,22,0.98), rgba(12,12,16,0.96)); padding:20px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); }
  .modal h3{ margin:0 0 8px 0; color:var(--accent-2); }
  .modal p{ margin:6px 0; color:#eaf5ff; }
  .modal .status.alive { color:#7be37b; font-weight:700; }
  .modal .status.deceased { color:#ff6b6b; font-weight:700; }
  .modal .close-btn { float:right; background:transparent; border:0; color:var(--muted); font-size:20px; cursor:pointer; }

  @media (max-width:420px){
    .player{ left:12px; right:12px; min-width:auto; height:56px; }
    .vol input[type=range]{ display:none; }
    .member-avatar, .opponent-avatar{ width:48px; height:48px; }
  }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <div class="page-bg" aria-hidden="true"></div>

  <div class="wrap">
    <section class="hero" aria-labelledby="hero-title">
      <div class="hero-inner">
        <img class="hero-logo" src="https://i.ibb.co/C3gpNWgG/RISKY-BANDS-x-LIL-QUISSY-HOT-CARS-OFFICIAL-VIDEO-EA-4-K-FILMS.gif" alt="Risky Road server logo">
        <h1 id="hero-title" class="hero-title"><span class="hero-accent">Risky Road</span> Faction Showcase</h1>
        <p class="hero-sub">Welcome — enjoy the showcase.</p>

        <nav class="nav" aria-label="Main navigation">
          <a class="nav-link active" data-tab="riskyroad" href="#"><i class="fa-solid fa-road"></i> Set Profile</a>
          <a class="nav-link" data-tab="faction" href="#"><i class="fa-solid fa-users"></i> Faction Showcase</a>
          <a class="nav-link" data-tab="activemembers" href="#"><i class="fa-solid fa-id-card"></i> Active Members</a>
          <a class="nav-link" data-tab="opps" href="#"><i class="fa-solid fa-skull-crossbones"></i> Opps</a>
        </nav>
      </div>
    </section>

    <!-- Set Profile (image removed as requested) -->
    <div id="riskyroad" class="nav-section active">
      <div class="section-card">
        <div class="section-title">Risky Road (4CH)</div>
        <ul class="rr-list">
          <li class="rr-list-item"><span class="rr-list-title">Set:</span> Risky Road (104th &amp; Maryland)</li>
          <li class="rr-list-item"><span class="rr-list-title">Main Block:</span> 104th &amp; Maryland</li>
          <li class="rr-list-item"><span class="rr-list-title">Notable Blocks:</span> 105th &amp; Indiana → 107th &amp; Edbrooke</li>
          <li class="rr-list-item"><span class="rr-list-title">Gang Composition:</span> Predominantly composed of younger members tied to the Four Corner Hustlers (4CH) structure, guided by older OGs who’ve maintained presence in Roseland since the early 2010s. The younger generation keeps the block active through both street and social activity, while the older heads provide structure, discipline, and leadership to keep the Road organized and respected.</li>
          <li class="rr-list-item"><span class="rr-list-title">Area Formerly Controlled By:</span> Smaller 4CH-affiliated crews and independent neighborhood figures before Risky Road unified the area under the same name.</li>
          <li class="rr-list-item"><span class="rr-list-title">Neighborhood:</span> Roseland, South Side, Chicago, Illinois</li>
          <li class="rr-list-item"><span class="rr-list-title">Deceased Members:</span> Several fallen members have left their mark on the neighborhood, honored through murals, candles, and social media tributes. Their memory serves as motivation for the younger generation to keep the Road’s name alive.</li>
          <li class="rr-list-item"><span class="rr-list-title">Rappers:</span> A handful of active members have stepped into Chicago’s local drill and trap music scene, releasing songs inspired by the Road’s daily life, struggles, and neighborhood pride. Their music has built local buzz, with tracks circulating through platforms like YouTube and SoundCloud, further solidifying the set’s identity and presence online.</li>
          <li class="rr-list-item"><span class="rr-list-title">Allies:</span> Primarily aligned with other Four Corner Hustler sets across the South and West Sides. Some neutral or respectful ties with select BD and unaffiliated neighborhood crews.</li>
          <li class="rr-list-item"><span class="rr-list-title">Years Active:</span> Early 2010s – Present.</li>
        </ul>
      </div>
    </div>

    <div id="faction" class="nav-section">
      <div class="section-card">
        <div class="section-title">Faction Showcase</div>
        <p>This section highlights special faction items and showcase content. Customize as needed.</p>
      </div>
    </div>

    <!-- Active Members -->
    <div id="activemembers" class="nav-section">
      <div class="section-card">
        <div class="section-title">Active Members</div>
        <div id="membersGrid" aria-live="polite"></div>
      </div>
    </div>

    <!-- Opps: each opponent is a box that shows its street on click; boxes glow red -->
    <div id="opps" class="nav-section">
      <div class="section-card">
        <div class="section-title">Opps</div>
        <p><strong>Currently above:</strong> BloodHound/79, DottieRoad, NLMB, ShortyMobb.</p>
        <div id="oppsGrid" aria-live="polite"></div>
      </div>
    </div>

    <div class="watermark">
      <a id="watermarkLink" href="https://youtu.be/_C9WqqXDQoE?si=VLnfOZDwR0FOL637" target="_blank" rel="noopener noreferrer">made by slimestslime</a>
    </div>
  </div>

  <!-- Right discord tab -->
  <div class="discord-tab" aria-hidden="false">
    <a id="discordLink" href="https://discord.gg/wcKtenyh" target="_blank" rel="noopener noreferrer" aria-label="Join our Discord">
      <span class="discord-divider">|</span>
      <i class="fa-brands fa-discord" style="font-size:20px;color:var(--accent-2)"></i>
    </a>
  </div>

  <!-- Hidden YouTube iframe player -->
  <div id="yt-player-wrap" style="width:0;height:0;overflow:hidden;position:fixed;left:-9999px;top:-9999px;">
    <div id="yt-player"></div>
  </div>

  <!-- Player UI -->
  <div class="player" role="region" aria-label="Music player" id="player">
    <div class="left">
      <button id="playBtn" class="play-btn paused" aria-pressed="false" aria-label="Play">
        <i id="playIcon" class="fa-solid fa-play"></i>
      </button>
      <div class="track-meta">
        <div class="track-title" id="trackTitle">Loading playlist…</div>
        <div class="track-sub" id="trackArtist">YouTube playlist</div>
      </div>
    </div>

    <div class="center">
      <div class="progress" id="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" tabindex="0" aria-label="Track progress">
        <div class="filled" id="progressFilled"></div>
      </div>
      <div class="time-row">
        <div id="timeElapsed">0:00</div>
        <div id="timeTotal">0:00</div>
      </div>
    </div>

    <div class="right">
      <div class="vol">
        <button id="muteBtn" class="small-btn" aria-label="Mute/unmute"><i id="muteIcon" class="fa-solid fa-volume-high"></i></button>
        <input id="volRange" type="range" min="0" max="1" step="0.01" value="0.8" aria-label="Volume slider">
      </div>
      <button id="toggleLoop" class="small-btn" title="Toggle loop" aria-pressed="false"><i class="fa-solid fa-repeat"></i></button>
      <button id="prevBtn" class="small-btn" title="Previous track"><i class="fa-solid fa-backward"></i></button>
      <button id="nextBtn" class="small-btn" title="Next track"><i class="fa-solid fa-forward"></i></button>
    </div>
  </div>

  <!-- Unmute / Play fallback -->
  <button id="unmuteBtn" class="unmute" aria-hidden="true" title="Enable music"><i class="fa-solid fa-volume-high"></i><span style="min-width:6ch">Play</span></button>

  <!-- Member modal (re-used for members) -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document">
      <button class="close-btn" id="modalClose" aria-label="Close profile">&times;</button>
      <h3 id="modalName">Member</h3>
      <img id="modalAvatar" src="" alt="" style="width:120px;height:120px;border-radius:8px;object-fit:cover;border:1px solid rgba(255,255,255,0.04);display:block;margin:8px 0;">
      <p><strong>Character Name:</strong> <span id="modalChar">—</span></p>
      <p><strong>Age:</strong> <span id="modalAge">—</span></p>
      <p><strong>Status:</strong> <span id="modalStatus" class="status">—</span></p>
    </div>
  </div>

  <!-- Opp modal (shows street name) -->
  <div id="oppModalBackdrop" class="modal-backdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document">
      <button class="close-btn" id="oppModalClose" aria-label="Close">&times;</button>
      <h3 id="oppModalName">Opp</h3>
      <p><strong>Street:</strong> <span id="oppModalStreet">—</span></p>
      <p style="color:var(--muted);font-size:13px;margin-top:8px;">Click outside or press Esc to close.</p>
    </div>
  </div>

<script>
/* ---------- Active members data (unchanged) ---------- */
const members = [
  {
    id: 'm1',
    display: 'MookMoneyy',
    role: 'shorties, 104th & Princeton',
    charName: 'MookMoneyy',
    age: 16,
    alive: true,
    avatar: 'https://i.ibb.co/tP33Sj8Z/GTA5-2025-07-18-05-07-43-503.webp'
  },
  {
    id: 'm2',
    display: 'Marcus "Solo" Hayes',
    role: 'Shooter, Main Block',
    charName: 'Marcus Hayes',
    age: 24,
    alive: true,
    avatar: 'https://i.pravatar.cc/150?img=12'
  },
  {
    id: 'm3',
    display: 'Tony "OG Tone" Jackson',
    role: 'OG, Faction Leader',
    charName: 'Tony Jackson',
    age: 42,
    alive: false,
    avatar: 'https://i.pravatar.cc/150?img=8'
  }
];

function renderMembersGrid() {
  const grid = document.getElementById('membersGrid');
  grid.innerHTML = '';
  members.forEach(m => {
    const card = document.createElement('div');
    card.className = 'member-card';
    card.tabIndex = 0;
    card.dataset.id = m.id;
    card.innerHTML = `
      <img class="member-avatar" src="${m.avatar}" alt="${m.display} avatar">
      <div style="min-width:0">
        <div class="member-name">${m.display}</div>
        <div class="member-role">${m.role}</div>
      </div>
    `;
    card.addEventListener('click', () => openMemberModal(m.id));
    card.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openMemberModal(m.id); } });
    grid.appendChild(card);
  });
}

function openMemberModal(id){
  const m = members.find(x => x.id === id);
  if(!m) return;
  document.getElementById('modalName').textContent = m.display;
  document.getElementById('modalAvatar').src = m.avatar;
  document.getElementById('modalAvatar').alt = m.display + ' avatar';
  document.getElementById('modalChar').textContent = m.charName;
  document.getElementById('modalAge').textContent = m.age;
  const statusEl = document.getElementById('modalStatus');
  statusEl.textContent = m.alive ? 'Alive' : 'Deceased';
  statusEl.className = 'status ' + (m.alive ? 'alive' : 'deceased');
  const backdrop = document.getElementById('modalBackdrop');
  backdrop.classList.add('show');
  backdrop.setAttribute('aria-hidden','false');
  document.getElementById('modalClose').focus();
}
function closeModal() {
  const backdrop = document.getElementById('modalBackdrop');
  backdrop.classList.remove('show');
  backdrop.setAttribute('aria-hidden','true');
}
document.getElementById('modalClose').addEventListener('click', closeModal);
document.getElementById('modalBackdrop').addEventListener('click', (e) => { if (e.target === e.currentTarget) closeModal(); });

renderMembersGrid();

/* ---------- Opponents data & UI ---------- */
/* The streets provided:
   - BloodHound/79  -> East 79th and South Maryland
   - ShortyMobb     -> East 79th and South Maryland
   - NLMB           -> 78th and Muskegon
   - DottieRoad     -> 72nd & Coles Avenue
*/
const opponents = [
  { id: 'o1', name: 'BloodHound/79', role: 'Opposing set', street: 'East 79th and South Maryland', avatar: 'https://i.pravatar.cc/150?img=5' },
  { id: 'o2', name: 'ShortyMobb', role: 'Opposing set', street: 'East 79th and South Maryland', avatar: 'https://i.pravatar.cc/150?img=6' },
  { id: 'o3', name: 'NLMB', role: 'Opposing set', street: '78th and Muskegon', avatar: 'https://i.pravatar.cc/150?img=7' },
  { id: 'o4', name: 'DottieRoad', role: 'Opposing set', street: '72nd & Coles Avenue', avatar: 'https://i.pravatar.cc/150?img=9' }
];

function renderOppsGrid() {
  const grid = document.getElementById('oppsGrid');
  grid.innerHTML = '';
  opponents.forEach(o => {
    const card = document.createElement('div');
    card.className = 'opponent-card';
    card.tabIndex = 0;
    card.dataset.id = o.id;
    card.innerHTML = `
      <img class="opponent-avatar" src="${o.avatar}" alt="${o.name} avatar">
      <div style="min-width:0">
        <div class="opponent-name">${o.name}</div>
        <div class="opponent-role">${o.role}</div>
      </div>
    `;
    // add persistent glow class so they always have the red outer glow
    card.classList.add('glow');
    card.addEventListener('click', () => openOppModal(o.id));
    card.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openOppModal(o.id); } });
    grid.appendChild(card);
  });
}

function openOppModal(id) {
  const o = opponents.find(x => x.id === id);
  if (!o) return;
  document.getElementById('oppModalName').textContent = o.name;
  document.getElementById('oppModalStreet').textContent = o.street;
  const backdrop = document.getElementById('oppModalBackdrop');
  backdrop.classList.add('show');
  backdrop.setAttribute('aria-hidden','false');
  document.getElementById('oppModalClose').focus();
}

function closeOppModal() {
  const backdrop = document.getElementById('oppModalBackdrop');
  backdrop.classList.remove('show');
  backdrop.setAttribute('aria-hidden','true');
}
document.getElementById('oppModalClose').addEventListener('click', closeOppModal);
document.getElementById('oppModalBackdrop').addEventListener('click', (e) => { if (e.target === e.currentTarget) closeOppModal(); });

renderOppsGrid();

/* ---------- Tabs behavior ---------- */
document.querySelectorAll('.nav-link').forEach(link=>{
  link.addEventListener('click', e=>{
    e.preventDefault();
    document.querySelectorAll('.nav-link').forEach(l=>l.classList.remove('active'));
    document.querySelectorAll('.nav-section').forEach(s=>s.classList.remove('active'));
    link.classList.add('active');
    const tab = link.getAttribute('data-tab');
    const el = document.getElementById(tab);
    if (el) el.classList.add('active');
  });
});

/* ---------- YouTube playlist + player UI (keeps previous playlist behavior) ---------- */
const ytPlaylist = [
  { id: 'A2h-dN8fWFQ', title: 'Track 1' },
  { id: '5EgOq543xH0', title: 'Track 2' },
  { id: 'ZcDObWYToXY', title: 'Track 3' }
];

let ytPlayer = null;
let currentIndex = 0;
let ytReady = false;
let progressTimer = null;
let loopCurrent = false;
let autoplayAttempts = 0;
const MAX_AUTOPLAY_ATTEMPTS = 12;

/* load YT Iframe API */
(function loadYT(){
  if (window.YT && window.YT.Player) { onYouTubeIframeAPIReady(); return; }
  const tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  document.head.appendChild(tag);
})();

function onYouTubeIframeAPIReady(){
  ytPlayer = new YT.Player('yt-player', {
    height: '0', width: '0',
    videoId: ytPlaylist[currentIndex].id,
    playerVars: {
      autoplay: 1,
      controls: 0,
      modestbranding: 1,
      rel: 0,
      disablekb: 1,
      playsinline: 1
    },
    events: {
      'onReady': onPlayerReady,
      'onStateChange': onPlayerStateChange,
      'onError': onPlayerError
    }
  });
}

function onPlayerReady() {
  ytReady = true;
  const vol = Math.round((parseFloat(document.getElementById('volRange').value) || 0.8) * 100);
  try { ytPlayer.setVolume(vol); } catch(e){}
  updateTrackMeta();
  attemptAutoplay();
}
function onPlayerError(e){}
function onPlayerStateChange(event){
  const YTSTATE = YT.PlayerState;
  if (event.data === YTSTATE.PLAYING) {
    setPlayingUI(true);
    startProgressTimer();
    hideUnmute();
  } else if (event.data === YTSTATE.PAUSED) {
    setPlayingUI(false);
    stopProgressTimer();
  } else if (event.data === YTSTATE.ENDED) {
    stopProgressTimer();
    if (loopCurrent) {
      ytPlayer.seekTo(0);
      ytPlayer.playVideo();
    } else {
      playNext();
    }
  }
}

function setPlayingUI(playing){
  if (playing) {
    document.getElementById('playBtn').classList.remove('paused');
    document.getElementById('playIcon').className = 'fa-solid fa-pause';
    document.getElementById('playBtn').setAttribute('aria-pressed','true');
    document.getElementById('playBtn').setAttribute('aria-label','Pause');
  } else {
    document.getElementById('playBtn').classList.add('paused');
    document.getElementById('playIcon').className = 'fa-solid fa-play';
    document.getElementById('playBtn').setAttribute('aria-pressed','false');
    document.getElementById('playBtn').setAttribute('aria-label','Play');
  }
}

function formatTime(s){ if (!isFinite(s)) return '0:00'; s = Math.floor(s); const m = Math.floor(s/60); const sec = s % 60; return m + ':' + (sec < 10 ? '0'+sec : sec); }

function startProgressTimer(){
  stopProgressTimer();
  progressTimer = setInterval(()=> {
    if (!ytReady || !ytPlayer || typeof ytPlayer.getCurrentTime !== 'function') return;
    const cur = ytPlayer.getCurrentTime() || 0;
    const dur = ytPlayer.getDuration() || 0;
    const pct = dur ? (cur / dur) * 100 : 0;
    document.getElementById('progressFilled').style.width = pct + '%';
    document.getElementById('progress').setAttribute('aria-valuenow', Math.round(pct));
    document.getElementById('timeElapsed').textContent = formatTime(cur);
    document.getElementById('timeTotal').textContent = formatTime(dur);
  }, 400);
}
function stopProgressTimer(){ if (progressTimer) { clearInterval(progressTimer); progressTimer = null; } }

function updateTrackMeta(){
  const meta = ytPlaylist[currentIndex] || {};
  document.getElementById('trackTitle').textContent = meta.title || meta.id || 'YouTube track';
  document.getElementById('trackArtist').textContent = `Track ${currentIndex+1} of ${ytPlaylist.length}`;
}

/* Repeated autoplay attempts to maximize chance it starts automatically */
function attemptAutoplay(){
  if (!ytReady) return;
  autoplayAttempts++;
  try {
    ytPlayer.loadVideoById(ytPlaylist[currentIndex].id);
    ytPlayer.playVideo && ytPlayer.playVideo();
  } catch(e){}
  setTimeout(()=> {
    const state = ytPlayer && ytPlayer.getPlayerState ? ytPlayer.getPlayerState() : -1;
    if (state === YT.PlayerState.PLAYING) {
      setPlayingUI(true);
      hideUnmute();
    } else {
      setPlayingUI(false);
      if (autoplayAttempts < MAX_AUTOPLAY_ATTEMPTS) {
        setTimeout(attemptAutoplay, 1000);
      } else {
        showUnmute();
      }
    }
  }, 700);
}
window.addEventListener('visibilitychange', () => { if (document.visibilityState === 'visible' && ytReady) attemptAutoplay(); });
window.addEventListener('focus', () => { if (ytReady) attemptAutoplay(); });

/* playback controls */
function playPauseToggle(){ if (!ytReady) { showUnmute(); return; } const state = ytPlayer.getPlayerState(); if (state === YT.PlayerState.PLAYING) ytPlayer.pauseVideo(); else ytPlayer.playVideo(); }
function loadAndPlayIndex(index){ if (!ytReady) return; currentIndex = (index + ytPlaylist.length) % ytPlaylist.length; updateTrackMeta(); try { ytPlayer.loadVideoById(ytPlaylist[currentIndex].id); } catch(e){ ytPlayer.cueVideoById(ytPlaylist[currentIndex].id); setTimeout(()=> ytPlayer.playVideo(), 300); } }
function playNext(){ currentIndex = (currentIndex + 1) % ytPlaylist.length; loadAndPlayIndex(currentIndex); }
function playPrev(){ currentIndex = (currentIndex - 1 + ytPlaylist.length) % ytPlaylist.length; loadAndPlayIndex(currentIndex); }

function seekFromEvent(ev){ if (!ytReady || !ytPlayer) return; const rect = document.getElementById('progress').getBoundingClientRect(); const x = ('touches' in ev && ev.touches && ev.touches[0]) ? ev.touches[0].clientX : ev.clientX; const pct = Math.max(0, Math.min(1, (x - rect.left) / rect.width)); const dur = ytPlayer.getDuration() || 0; if (dur) ytPlayer.seekTo(pct * dur, true); }

function setVolumeFromRange(value){ const vol = Math.round(parseFloat(value || 0.8) * 100); if (ytReady && ytPlayer && ytPlayer.setVolume) { ytPlayer.setVolume(vol); if (vol === 0) document.getElementById('muteIcon').className = 'fa-solid fa-volume-xmark'; else document.getElementById('muteIcon').className = 'fa-solid fa-volume-high'; } }
function toggleMute(){ if (!ytReady || !ytPlayer) return; if (ytPlayer.isMuted && ytPlayer.isMuted()) { ytPlayer.unMute(); document.getElementById('muteIcon').className = 'fa-solid fa-volume-high'; } else { ytPlayer.mute(); document.getElementById('muteIcon').className = 'fa-solid fa-volume-xmark'; } }

function showUnmute(){ const el = document.getElementById('unmuteBtn'); el.classList.add('show'); el.setAttribute('aria-hidden','false'); }
function hideUnmute(){ const el = document.getElementById('unmuteBtn'); el.classList.remove('show'); el.setAttribute('aria-hidden','true'); }

/* wire UI events */
document.getElementById('playBtn').addEventListener('click', (e)=> { e.preventDefault(); playPauseToggle(); });
document.getElementById('nextBtn').addEventListener('click', (e)=> { e.preventDefault(); playNext(); });
document.getElementById('prevBtn').addEventListener('click', (e)=> { e.preventDefault(); playPrev(); });
document.getElementById('volRange').addEventListener('input', (e)=> setVolumeFromRange(e.target.value));
document.getElementById('muteBtn').addEventListener('click', (e)=> { e.preventDefault(); toggleMute(); });
document.getElementById('progress').addEventListener('click', seekFromEvent);
document.getElementById('toggleLoop').addEventListener('click', (e)=> { loopCurrent = !loopCurrent; e.currentTarget.setAttribute('aria-pressed', String(loopCurrent)); e.currentTarget.style.opacity = loopCurrent ? '1' : '0.6'; });

document.getElementById('unmuteBtn').addEventListener('click', async (e)=> {
  e.preventDefault();
  hideUnmute();
  if (!ytReady) return;
  try { ytPlayer.loadVideoById(ytPlaylist[currentIndex].id); ytPlayer.playVideo(); } catch(e){ try { ytPlayer.playVideo(); } catch(e){} }
});

window.addEventListener('keydown', (e)=> {
  const tag = (document.activeElement && document.activeElement.tagName) || '';
  if (e.code === 'Space' && !['INPUT','TEXTAREA','SELECT','BUTTON'].includes(tag)) {
    e.preventDefault();
    document.getElementById('playBtn').click();
  }
});

/* initialize UI */
updateTrackMeta();

/* cleanup */
window.addEventListener('beforeunload', ()=> { if (progressTimer) clearInterval(progressTimer); });

</script>
</body>
</html>
